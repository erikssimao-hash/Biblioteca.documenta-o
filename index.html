<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Erik's Data Vault v11.0</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- CSS BASE --- */
        :root {
            --bg-deep: #050505;
            --bg-surface: #121212;
            --bg-glass: rgba(20, 20, 20, 0.98);
            --border-glass: rgba(255, 255, 255, 0.1);
            --primary: #00ff88; 
            --secondary: #00ccff;
            --accent-sql: #ff9f43;
            --accent-py: #54a0ff;
            --text-main: #ffffff;
            --text-muted: #b0b0b0;
        }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: 'Inter', 'Segoe UI', sans-serif;
            margin: 0;
            padding-top: 0;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 255, 136, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 204, 255, 0.05) 0%, transparent 20%);
        }

        /* --- HEADER FIXO --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%;
            background: rgba(5, 5, 5, 0.9); backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-glass); padding: 15px 0;
            z-index: 1000; display: flex; justify-content: center;
        }

        .header-content {
            width: 90%; max-width: 1200px; display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px;
        }

        .logo {
            font-size: 1.5rem; font-weight: 800;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            display: flex; align-items: center; gap: 10px;
        }

        .controls-wrapper { display: flex; gap: 20px; align-items: center; }
        .controls { display: flex; gap: 15px; align-items: center; }

        .menu-btn {
            background: transparent; border: none; color: var(--text-main); font-size: 1.5rem;
            cursor: pointer; padding: 5px 10px; border-radius: 50%; transition: 0.3s;
        }
        .menu-btn:hover { background: rgba(255,255,255,0.1); color: var(--primary); }

        /* --- HERO SECTION (OBJETIVO) --- */
        .hero-section {
            padding: 120px 20px 40px;
            text-align: center;
            max-width: 900px;
            margin: 0 auto;
        }

        .objective-box {
            background: rgba(0, 255, 136, 0.03);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 16px;
            padding: 30px;
            position: relative;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.05);
        }

        .objective-title {
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: block;
        }

        .objective-text {
            font-size: 1.2rem;
            line-height: 1.6;
            color: #e0e0e0;
            margin: 0;
        }

        .highlight { color: #fff; font-weight: 600; text-decoration: underline; text-decoration-color: var(--primary); }

        /* --- SIDEBAR --- */
        .sidebar {
            position: fixed; top: 0; right: -450px; width: 400px; height: 100vh;
            background: var(--bg-glass); backdrop-filter: blur(15px);
            border-left: 1px solid var(--border-glass); z-index: 2000;
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1); padding: 20px; overflow-y: auto;
            box-shadow: -10px 0 30px rgba(0,0,0,0.5);
        }
        .sidebar.open { right: 0; }

        .sidebar-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 30px; border-bottom: 1px solid var(--border-glass); padding-bottom: 15px;
        }

        .close-btn { background: none; border: none; color: var(--text-muted); font-size: 1.2rem; cursor: pointer; }
        .close-btn:hover { color: #fff; }

        .cheat-item {
            background: rgba(255,255,255,0.03); border-radius: 6px; padding: 15px;
            margin-bottom: 10px; border: 1px solid transparent; transition: 0.2s; cursor: pointer;
        }
        .cheat-item:hover { border-color: var(--primary); background: rgba(255,255,255,0.08); transform: translateX(5px); }
        .cmd-name { font-family: 'Fira Code', monospace; color: var(--secondary); font-size: 0.95rem; display: block; margin-bottom: 6px; font-weight: bold; }
        .cmd-desc { font-size: 0.85rem; color: var(--text-muted); line-height: 1.5; }

        /* --- MODAL (POPUP) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 3000;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; transition: 0.3s;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }

        .modal-content {
            background: #1a1a1a; border: 1px solid var(--border-glass); border-radius: 12px;
            width: 90%; max-width: 700px; padding: 30px; position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.7); transform: scale(0.95); transition: 0.3s;
        }
        .modal-overlay.active .modal-content { transform: scale(1); }

        .modal-title { color: var(--primary); margin-top: 0; font-size: 1.6rem; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid var(--border-glass); padding-bottom: 15px; margin-bottom: 15px;}
        .modal-desc { color: #e0e0e0; margin-bottom: 20px; line-height: 1.7; font-size: 1rem; }
        
        .modal-close {
            position: absolute; top: 20px; right: 25px; font-size: 1.5rem;
            color: var(--text-muted); cursor: pointer; background: none; border: none;
        }
        .modal-close:hover { color: #fff; }

        /* --- COMMON UI --- */
        .search-box input {
            background: var(--bg-surface); border: 1px solid var(--border-glass);
            padding: 8px 15px 8px 35px; border-radius: 20px; color: white; outline: none; width: 200px;
        }
        .search-box i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 0.8rem;}
        .search-box { position: relative; }

        .filter-btn {
            background: transparent; border: 1px solid var(--border-glass); color: var(--text-muted);
            padding: 6px 12px; border-radius: 20px; cursor: pointer; font-size: 0.85rem;
        }
        .filter-btn:hover, .filter-btn.active { background: var(--bg-surface); color: white; border-color: var(--primary); }

        .container {
            max-width: 1200px; margin: 0 auto 50px; padding: 20px;
            display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px;
        }
        
        /* CARD STYLES */
        .card { background: var(--bg-surface); border: 1px solid var(--border-glass); border-radius: 12px; overflow: hidden; transition: transform 0.3s; }
        .card:hover { transform: translateY(-5px); border-color: rgba(255,255,255,0.2); }
        .card-header { padding: 20px; display: flex; justify-content: space-between; }
        .card-title { font-weight: 700; margin-bottom: 5px; display: block; }
        .card-meta { font-size: 0.85rem; color: var(--text-muted); }
        .badge { font-size: 0.7rem; padding: 4px 8px; border-radius: 6px; font-weight: 700; text-transform: uppercase; }
        .badge-sql { color: var(--accent-sql); background: rgba(255, 159, 67, 0.1); border: 1px solid rgba(255, 159, 67, 0.3); }
        .badge-py { color: var(--accent-py); background: rgba(84, 160, 255, 0.1); border: 1px solid rgba(84, 160, 255, 0.3); }
        .badge-web { color: var(--accent-web); background: rgba(255, 107, 107, 0.1); border: 1px solid rgba(255, 107, 107, 0.3); }

        .code-block {
            background: #080808; padding: 20px; border-top: 1px solid var(--border-glass);
            font-family: 'Fira Code', monospace; font-size: 0.95rem; color: #d4d4d4; position: relative; overflow-x: auto;
            border-radius: 0 0 12px 12px;
        }
        .copy-btn {
            position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.1);
            border: none; color: var(--text-muted); padding: 5px 10px; border-radius: 4px;
            cursor: pointer; font-size: 0.8rem;
        }
        
        .kwd { color: #ff79c6; font-weight: bold; } 
        .func { color: #8be9fd; } 
        .str { color: #f1fa8c; } 
        .com { color: #6272a4; font-style: italic; }

        #toast {
            visibility: hidden; min-width: 250px; background-color: var(--primary); color: #000;
            text-align: center; border-radius: 8px; padding: 16px; position: fixed; z-index: 4000;
            left: 50%; bottom: 30px; transform: translateX(-50%); font-weight: bold; opacity: 0; transition: opacity 0.3s;
        }
        #toast.show { visibility: visible; opacity: 1; }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1500; opacity: 0; visibility: hidden; transition: 0.3s;
        }
        .overlay.show { opacity: 1; visibility: visible; }
    </style>
</head>
<body>

    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <div class="modal-overlay" id="cheatModal" onclick="closeCheatModal(event)">
        <div class="modal-content">
            <button class="modal-close" onclick="closeCheatModal(null, true)"><i class="fas fa-times"></i></button>
            <h2 class="modal-title" id="mTitle"></h2>
            <p class="modal-desc" id="mDesc"></p>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                <pre id="mCode"></pre>
            </div>
        </div>
    </div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <span class="sidebar-title" style="color:var(--text-main)"><i class="fas fa-bolt" style="color:var(--primary)"></i> Cheat Sheet</span>
            <button class="close-btn" onclick="toggleSidebar()"><i class="fas fa-times"></i></button>
        </div>

        <div class="cheat-category">
            <h3 style="color: var(--accent-sql); margin-top:0;"><i class="fas fa-database"></i> SQL PRO</h3>
            
            <div class="cheat-item" onclick="openCheat('sql_cte')">
                <span class="cmd-name">CTE (WITH) <span style="font-size:0.7em; color: var(--primary)">★ NOVO</span></span>
                <span class="cmd-desc">Queries organizadas e reutilizáveis (adeus subquery).</span>
            </div>
            <div class="cheat-item" onclick="openCheat('sql_dates')">
                <span class="cmd-name">DATE TRUNC (Datas) <span style="font-size:0.7em; color: var(--primary)">★ NOVO</span></span>
                <span class="cmd-desc">Agrupar por Mês/Semana do jeito certo.</span>
            </div>
            <div class="cheat-item" onclick="openCheat('sql_running_total')">
                <span class="cmd-name">SOMA ACUMULADA <span style="font-size:0.7em; color: var(--primary)">★ NOVO</span></span>
                <span class="cmd-desc">KPIs de Running Total com Window Function.</span>
            </div>
            <div class="cheat-item" onclick="openCheat('sql_joins')">
                <span class="cmd-name">GUIAS DE JOINS (VISUAL)</span>
                <span class="cmd-desc">Entenda de vez a diferença entre Inner, Left, Right e Full.</span>
            </div>
            <div class="cheat-item" onclick="openCheat('sql_count')">
                <span class="cmd-name">COUNT vs COUNT DISTINCT</span>
                <span class="cmd-desc">A diferença entre contar linhas e contar itens únicos.</span>
            </div>
            <div class="cheat-item" onclick="openCheat('sql_window')">
                <span class="cmd-name">WINDOW FUNCTIONS (LAG)</span>
                <span class="cmd-desc">Comparar valor atual com anterior (Growth).</span>
            </div>
             <div class="cheat-item" onclick="openCheat('sql_rank')">
                <span class="cmd-name">ROW_NUMBER & RANK</span>
                <span class="cmd-desc">Criando rankings (Top 1, Top 3) dentro de categorias.</span>
            </div>
            <div class="cheat-item" onclick="openCheat('sql_distinct')">
                <span class="cmd-name">SELECT DISTINCT</span>
                <span class="cmd-desc">Limpando duplicatas do seu resultado.</span>
            </div>
            <div class="cheat-item" onclick="openCheat('sql_having')">
                <span class="cmd-name">HAVING vs WHERE</span>
                <span class="cmd-desc">Quando usar cada um para filtrar dados.</span>
            </div>
             <div class="cheat-item" onclick="openCheat('sql_coalesce')">
                <span class="cmd-name">COALESCE (Tratar Nulos)</span>
                <span class="cmd-desc">Evite erros de cálculo substituindo NULL por zero.</span>
            </div>
        </div>

        <div class="cheat-category">
            <h3 style="color: var(--accent-py)"><i class="fab fa-python"></i> Pandas PRO</h3>
            
            <div class="cheat-item" onclick="openCheat('py_pivot')">
                <span class="cmd-name">PIVOT TABLE <span style="font-size:0.7em; color: var(--primary)">★ NOVO</span></span>
                <span class="cmd-desc">Transformar linhas em colunas (Relatórios).</span>
            </div>
            <div class="cheat-item" onclick="openCheat('py_str_clean')">
                <span class="cmd-name">LIMPEZA DE TEXTO <span style="font-size:0.7em; color: var(--primary)">★ NOVO</span></span>
                <span class="cmd-desc">Lower, strip, replace e contains (Vectorized).</span>
            </div>
            <div class="cheat-item" onclick="openCheat('py_duplicates')">
                <span class="cmd-name">REMOVER DUPLICATAS <span style="font-size:0.7em; color: var(--primary)">★ NOVO</span></span>
                <span class="cmd-desc">Deduplicação mantendo o registro mais recente.</span>
            </div>
            <div class="cheat-item" onclick="openCheat('py_info')">
                <span class="cmd-name">Análise Exploratória</span>
                <span class="cmd-desc">df.info(), describe() e value_counts().</span>
            </div>
            <div class="cheat-item" onclick="openCheat('py_groupby')">
                <span class="cmd-name">Agrupamento (Groupby)</span>
                <span class="cmd-desc">Criando tabelas dinâmicas com Python.</span>
            </div>
             <div class="cheat-item" onclick="openCheat('py_loc')">
                <span class="cmd-name">Filtros Avançados (Loc)</span>
                <span class="cmd-desc">Condições complexas com E (&) e OU (|).</span>
            </div>
        </div>
    </aside>

    <header>
        <div class="header-content">
            <div class="logo"><i class="fas fa-cube"></i> Erik's Vault</div>
            
            <div class="controls-wrapper">
                <div class="controls">
                    <button class="filter-btn active" onclick="filterSnippets('all')">Todos</button>
                    <button class="filter-btn" onclick="filterSnippets('sql')">SQL</button>
                    <button class="filter-btn" onclick="filterSnippets('py')">Py</button>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Buscar..." onkeyup="searchSnippets()">
                    </div>
                </div>
                <button class="menu-btn" onclick="toggleSidebar()"><i class="fas fa-ellipsis-v"></i></button>
            </div>
        </div>
    </header>

    <div class="hero-section">
        <div class="objective-box">
            <span class="objective-title"><i class="fas fa-bullseye"></i> OBJETIVO</span>
            <p class="objective-text">
                Esta biblioteca não é apenas um repositório de códigos. É o meu <span class="highlight">"segundo cérebro"</span> para acelerar análises, padronizar queries e eliminar tarefas repetitivas. 
                Foco em <b>impacto estratégico</b>, não apenas em execução técnica.
            </p>
        </div>
    </div>

    <div id="toast"><i class="fas fa-check-circle"></i> Copiado!</div>

    <div class="container" id="snippetContainer">
        
        <div class="card" data-category="sql">
            <div class="card-header">
                <div>
                    <span class="card-title">Agregação KPI</span>
                    <span class="card-meta">Agrupar lives e criar flags</span>
                </div>
                <span class="badge badge-sql">SQL</span>
            </div>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
<pre>
<span class="kwd">SELECT</span>
    campanha,
    <span class="func">COUNT</span>(live_id) <span class="kwd">AS</span> qtd_lives,
    <span class="func">SUM</span>(views) <span class="kwd">AS</span> total_alcance,
    <span class="func">CASE WHEN</span> <span class="func">SUM</span>(views) > 50000 
         <span class="kwd">THEN</span> <span class="str">'Meta Batida'</span> 
         <span class="kwd">ELSE</span> <span class="str">'Abaixo'</span> 
    <span class="kwd">END</span> <span class="kwd">AS</span> status_campanha
<span class="kwd">FROM</span> mitcup_data
<span class="kwd">GROUP BY</span> 1;
</pre>
            </div>
        </div>

        <div class="card" data-category="py">
            <div class="card-header">
                <div>
                    <span class="card-title">Churn Target Definition</span>
                    <span class="card-meta">Criar coluna alvo com Pandas</span>
                </div>
                <span class="badge badge-py">Python</span>
            </div>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
<pre>
<span class="kwd">import</span> pandas <span class="kwd">as</span> pd

<span class="com"># Define churn se inativo > 30 dias</span>
df[<span class="str">'is_churn'</span>] = df[<span class="str">'days_inactive'</span>].apply(
    <span class="kwd">lambda</span> x: 1 <span class="kwd">if</span> x > 30 <span class="kwd">else</span> 0
)
</pre>
            </div>
        </div>

        <div class="card" data-category="sql">
            <div class="card-header">
                <div>
                    <span class="card-title">Agrupamento Mensal (Date Trunc)</span>
                    <span class="card-meta">Essencial para relatórios de tendência</span>
                </div>
                <span class="badge badge-sql">SQL</span>
            </div>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
<pre>
<span class="kwd">SELECT</span> 
    <span class="com">-- Arredonda a data para o primeiro dia do mês</span>
    <span class="func">DATE_TRUNC</span>(<span class="str">'month'</span>, data_venda) <span class="kwd">AS</span> mes_referencia,
    <span class="func">COUNT</span>(<span class="kwd">DISTINCT</span> id_cliente) <span class="kwd">AS</span> total_clientes,
    <span class="func">SUM</span>(valor) <span class="kwd">AS</span> faturamento
<span class="kwd">FROM</span> vendas
<span class="kwd">WHERE</span> data_venda >= <span class="str">'2026-01-01'</span>
<span class="kwd">GROUP BY</span> 1
<span class="kwd">ORDER BY</span> 1;
</pre>
            </div>
        </div>

        <div class="card" data-category="sql">
            <div class="card-header">
                <div>
                    <span class="card-title">CTE: Query Organizada</span>
                    <span class="card-meta">Substitui subqueries confusas</span>
                </div>
                <span class="badge badge-sql">SQL</span>
            </div>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
<pre>
<span class="kwd">WITH</span> VendasPorVendedor <span class="kwd">AS</span> (
    <span class="kwd">SELECT</span> vendedor_id, <span class="func">SUM</span>(total) <span class="kwd">as</span> venda_total
    <span class="kwd">FROM</span> pedidos
    <span class="kwd">GROUP BY</span> vendedor_id
),
TopVendedores <span class="kwd">AS</span> (
    <span class="kwd">SELECT</span> * <span class="kwd">FROM</span> VendasPorVendedor
    <span class="kwd">WHERE</span> venda_total > 10000
)
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> TopVendedores;
</pre>
            </div>
        </div>

        <div class="card" data-category="py">
            <div class="card-header">
                <div>
                    <span class="card-title">Pandas Pivot Table</span>
                    <span class="card-meta">Igual ao Excel: Linhas viram Colunas</span>
                </div>
                <span class="badge badge-py">Python</span>
            </div>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
<pre>
<span class="kwd">import</span> pandas <span class="kwd">as</span> pd

<span class="com"># Cria relatório matriz: Vendedores x Meses</span>
relatorio = df.<span class="func">pivot_table</span>(
    index=<span class="str">'vendedor'</span>, 
    columns=<span class="str">'mes'</span>, 
    values=<span class="str">'valor'</span>, 
    aggfunc=<span class="str">'sum'</span>,
    fill_value=0
)
</pre>
            </div>
        </div>

        <div class="card" data-category="py">
            <div class="card-header">
                <div>
                    <span class="card-title">Deduplicação Inteligente</span>
                    <span class="card-meta">Manter apenas o registro mais recente</span>
                </div>
                <span class="badge badge-py">Python</span>
            </div>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
<pre>
<span class="com"># Ordena por data e remove duplicatas do ID</span>
df_limpo = df.<span class="func">sort_values</span>(
    by=<span class="str">'data_atualizacao'</span>, 
    ascending=<span class="kwd">False</span>
).<span class="func">drop_duplicates</span>(
    subset=[<span class="str">'id_cliente'</span>], 
    keep=<span class="str">'first'</span> <span class="com"># Mantém o mais novo</span>
)
</pre>
            </div>
        </div>
        
    </div>

    <script>
        const cheatData = {
            // --- SQL SECTION ---

            'sql_cte': {
                title: 'CTE (Common Table Expressions)',
                desc: 'Pare de usar subqueries aninhadas que ninguém entende! Use CTEs (WITH) para quebrar problemas complexos em etapas lógicas e legíveis.',
                code: `<span class="com">-- 1. Primeiro calculamos as vendas por vendedor</span>
<span class="kwd">WITH</span> VendasPorVendedor <span class="kwd">AS</span> (
    <span class="kwd">SELECT</span> id_vendedor, <span class="func">SUM</span>(valor) <span class="kwd">as</span> total
    <span class="kwd">FROM</span> vendas
    <span class="kwd">GROUP BY</span> id_vendedor
),
<span class="com">-- 2. Depois calculamos a média global</span>
MediaGlobal <span class="kwd">AS</span> (
    <span class="kwd">SELECT</span> <span class="func">AVG</span>(total) <span class="kwd">as</span> media <span class="kwd">FROM</span> VendasPorVendedor
)
<span class="com">-- 3. Cruzamos os dois para achar quem está acima da média</span>
<span class="kwd">SELECT</span> v.* <span class="kwd">FROM</span> VendasPorVendedor v
<span class="kwd">JOIN</span> MediaGlobal m <span class="kwd">ON</span> v.total > m.media;`
            },

            'sql_dates': {
                title: 'Date Trunc (Agrupamento Temporal)',
                desc: 'O jeito certo de agrupar por Mês, Semana ou Ano sem fazer gambiarra com strings. Essencial para análises de Cohort e tendência.',
                code: `<span class="com">-- PostgreSQL / BigQuery (Padrão Moderno)</span>
<span class="kwd">SELECT</span> 
    <span class="func">DATE_TRUNC</span>(<span class="str">'month'</span>, data_venda) <span class="kwd">as</span> mes_referencia,
    <span class="func">SUM</span>(valor)
<span class="kwd">FROM</span> vendas
<span class="kwd">GROUP BY</span> 1;

<span class="com">-- SQL Server</span>
<span class="kwd">SELECT</span> 
    <span class="func">FORMAT</span>(data_venda, <span class="str">'yyyy-MM'</span>) <span class="kwd">as</span> mes_referencia,
    <span class="func">SUM</span>(valor)
<span class="kwd">FROM</span> vendas
<span class="kwd">GROUP BY</span> 1;`
            },

            'sql_running_total': {
                title: 'Soma Acumulada (Running Total)',
                desc: 'Como fazer aquele gráfico onde a linha vai subindo ao longo do ano? Use SUM() com Window Function. Mágica pura.',
                code: `<span class="kwd">SELECT</span> 
    data,
    venda_do_dia,
    <span class="com">-- Soma o valor atual com TUDO o que veio antes dele</span>
    <span class="func">SUM</span>(venda_do_dia) <span class="kwd">OVER</span>(
        <span class="kwd">ORDER BY</span> data 
        <span class="kwd">ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</span>
    ) <span class="kwd">as</span> acumulado_anual
<span class="kwd">FROM</span> faturamento;`
            },
            
            'sql_joins': {
                title: 'O Guia Definitivo de JOINS',
                desc: 'A principal confusão em entrevistas e no dia a dia. Entenda quem fica e quem sai da tabela final.',
                code: `<span class="com">/* Tabela A (Esquerda) = Clientes
   Tabela B (Direita)  = Compras
*/</span>

<span class="com">-- 1. INNER JOIN (A Interseção)</span>
<span class="com">-- Só traz quem está NOS DOIS lados.</span>
<span class="com">-- Clientes que compraram algo. Se o cliente não comprou, ele some.</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> clientes A <span class="kwd">INNER JOIN</span> compras B <span class="kwd">ON</span> A.id = B.id_cli;

<span class="com">-- 2. LEFT JOIN (Prioridade para a Esquerda)</span>
<span class="com">-- Traz TODOS os clientes. Se ele comprou, mostra a compra.</span>
<span class="com">-- Se não comprou, traz NULL na parte da compra. (Ideal para achar inativos)</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> clientes A <span class="kwd">LEFT JOIN</span> compras B <span class="kwd">ON</span> A.id = B.id_cli;

<span class="com">-- 3. FULL JOIN (Tudo junto)</span>
<span class="com">-- Traz clientes sem compra E compras sem cliente (erro de base).</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> clientes A <span class="kwd">FULL JOIN</span> compras B <span class="kwd">ON</span> A.id = B.id_cli;`
            },

            'sql_count': {
                title: 'COUNT vs COUNT(DISTINCT)',
                desc: 'Parece bobo, mas muda tudo. COUNT(*) conta quantas linhas existem. COUNT(DISTINCT coluna) conta quantos valores únicos existem.',
                code: `<span class="com">-- Tabela Vendas: 100 linhas, mas feitas por apenas 5 clientes.</span>

<span class="com">-- Resultado: 100 (Total de transações)</span>
<span class="kwd">SELECT</span> <span class="func">COUNT</span>(*) <span class="kwd">FROM</span> vendas;

<span class="com">-- Resultado: 5 (Total de clientes únicos que compraram)</span>
<span class="kwd">SELECT</span> <span class="func">COUNT</span>(<span class="kwd">DISTINCT</span> id_cliente) <span class="kwd">FROM</span> vendas;

<span class="com">-- Dica PRO: Use para validar duplicidade em chaves primárias.</span>`
            },

            'sql_window': {
                title: 'Window Functions (LAG & LEAD)',
                desc: 'O segredo para análises de tempo (Time Series). Como comparar o valor de hoje com o de ontem sem precisar fazer joins complexos?',
                code: `<span class="kwd">SELECT</span> 
    mes,
    faturamento_atual,
    <span class="com">-- LAG: Olha para a linha anterior (mês passado)</span>
    <span class="func">LAG</span>(faturamento_atual) <span class="kwd">OVER</span>(<span class="kwd">ORDER BY</span> mes) <span class="kwd">as</span> faturamento_anterior,
    
    <span class="com">-- Cálculo de crescimento (Growth) na mesma linha</span>
    (faturamento_atual - <span class="func">LAG</span>(faturamento_atual) <span class="kwd">OVER</span>(<span class="kwd">ORDER BY</span> mes)) <span class="kwd">as</span> diferenca
<span class="kwd">FROM</span> financeiro;`
            },

            'sql_rank': {
                title: 'Rankeamento (ROW_NUMBER)',
                desc: 'Como selecionar "O produto mais vendido de CADA categoria" ou "A última compra de CADA cliente".',
                code: `<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> (
    <span class="kwd">SELECT</span> 
        cliente, 
        data_compra,
        <span class="com">-- Cria um ranking para cada cliente, ordenando por data (1 = mais recente)</span>
        <span class="func">ROW_NUMBER</span>() <span class="kwd">OVER</span>(<span class="kwd">PARTITION BY</span> cliente <span class="kwd">ORDER BY</span> data_compra <span class="kwd">DESC</span>) <span class="kwd">as</span> rn
    <span class="kwd">FROM</span> compras
) sub
<span class="kwd">WHERE</span> rn = 1; <span class="com">-- Filtra apenas a última compra de cada um</span>`
            },

            'sql_distinct': {
                title: 'SELECT DISTINCT',
                desc: 'Imagine que você tem uma lista de 1.000 pedidos, mas quer saber apenas quais CIDADES receberam pedidos. O DISTINCT elimina as repetições.',
                code: `<span class="com">-- Errado: Retorna 1.000 linhas (com cidades repetidas)</span>
<span class="kwd">SELECT</span> cidade <span class="kwd">FROM</span> pedidos;

<span class="com">-- Certo: Retorna apenas a lista única de cidades (ex: 20 linhas)</span>
<span class="kwd">SELECT DISTINCT</span> cidade 
<span class="kwd">FROM</span> pedidos
<span class="kwd">ORDER BY</span> cidade;`
            },

            'sql_having': {
                title: 'HAVING vs WHERE',
                desc: 'A regra de ouro: O WHERE filtra os dados originais (linha a linha). O HAVING filtra o resultado de um cálculo (agrupamento).',
                code: `<span class="com">-- 1. WHERE: Filtra transações de 2026 (antes de somar)</span>
<span class="kwd">SELECT</span> vendedor, <span class="func">SUM</span>(valor)
<span class="kwd">FROM</span> vendas
<span class="kwd">WHERE</span> ano = 2026 
<span class="kwd">GROUP BY</span> vendedor
<span class="com">-- 2. HAVING: Filtra quem vendeu mais de 10k (depois de somar)</span>
<span class="kwd">HAVING</span> <span class="func">SUM</span>(valor) > 10000;`
            },

            'sql_coalesce': {
                title: 'COALESCE (Limpando Nulos)',
                desc: 'Nulos (NULL) quebram contas matemáticas. 10 + NULL = NULL. Use o COALESCE para transformar NULL em 0 na hora da conta.',
                code: `<span class="kwd">SELECT</span> 
    produto,
    preco,
    <span class="com">-- Se o desconto for NULL, usa 0.</span>
    (preco - <span class="func">COALESCE</span>(desconto, 0)) <span class="kwd">as</span> preco_final
<span class="kwd">FROM</span> produtos;`
            },

            // --- PYTHON SECTION ---
            
            'py_pivot': {
                title: 'Pivot Table (Tabela Dinâmica)',
                desc: 'Transforma linhas em colunas. Ex: Transformar 12 linhas de meses em 12 colunas de meses para um relatório lado a lado.',
                code: `tabela_final = df.<span class="func">pivot_table</span>(
    index=<span class="str">'vendedor'</span>,      <span class="com"># O que vira linha</span>
    columns=<span class="str">'mes'</span>,           <span class="com"># O que vira coluna</span>
    values=<span class="str">'faturamento'</span>,    <span class="com"># O que preenche a célula</span>
    aggfunc=<span class="str">'sum'</span>,           <span class="com"># A conta (soma, média, contagem)</span>
    fill_value=0               <span class="com"># Se for nulo, põe zero</span>
)`
            },

            'py_str_clean': {
                title: 'Limpeza de Texto (Vectorized)',
                desc: 'Limpar sujeira de colunas de texto sem usar "for loop". Use o acessor .str para performance máxima.',
                code: `<span class="com"># 1. Tudo minúsculo e sem espaços nas pontas</span>
df[<span class="str">'email'</span>] = df[<span class="str">'email'</span>].str.<span class="func">lower</span>().str.<span class="func">strip</span>()

<span class="com"># 2. Substituir caracteres (ex: tirar R$ e converter pra float)</span>
df[<span class="str">'valor'</span>] = df[<span class="str">'valor'</span>].str.<span class="func">replace</span>(<span class="str">'R$'</span>, <span class="str">''</span>).<span class="func">astype</span>(float)

<span class="com"># 3. Filtrar quem CONTÉM um texto (ex: emails do Gmail)</span>
gmail_users = df[ df[<span class="str">'email'</span>].str.<span class="func">contains</span>(<span class="str">'@gmail'</span>) ]`
            },

             'py_duplicates': {
                title: 'Remover Duplicatas (Deduplicação)',
                desc: 'Limpeza crítica. Remove linhas repetidas mantendo a mais recente (last) ou a primeira (first).',
                code: `<span class="com"># Mantém apenas o registro mais recente de cada cliente</span>
df_limpo = df.<span class="func">sort_values</span>(<span class="str">'data_atualizacao'</span>).<span class="func">drop_duplicates</span>(
    subset=[<span class="str">'id_cliente'</span>], 
    keep=<span class="str">'last'</span>
)`
            },

            'py_info': {
                title: 'Exploração Inicial (Pandas)',
                desc: 'Os 3 comandos obrigatórios assim que você carrega um CSV. Sem isso, você está voando às cegas.',
                code: `<span class="com"># 1. Estrutura, Nulos e Tipos de Dados</span>
df.<span class="func">info</span>() 

<span class="com"># 2. Estatísticas (Média, Min, Max) das colunas numéricas</span>
df.<span class="func">describe</span>()

<span class="com"># 3. Contagem de itens em uma coluna categórica (Ex: Cidades)</span>
df[<span class="str">'cidade'</span>].<span class="func">value_counts</span>()`
            },
            
            'py_groupby': {
                title: 'Groupby (Tabela Dinâmica)',
                desc: 'A forma do Python de fazer o que você faz com Pivot Table no Excel.',
                code: `<span class="com"># Agrupa por 'Região' e soma o 'Valor'</span>
resumo = df.<span class="func">groupby</span>(<span class="str">'regiao'</span>)[<span class="str">'valor'</span>].<span class="func">sum</span>().<span class="func">reset_index</span>()

<span class="com"># Agrupamento múltiplo: Por Região e Categoria, calcule Soma e Média</span>
df.<span class="func">groupby</span>([<span class="str">'regiao'</span>, <span class="str">'categoria'</span>])[<span class="str">'valor'</span>].<span class="func">agg</span>([<span class="str">'sum'</span>, <span class="str">'mean'</span>])`
            },

            'py_loc': {
                title: 'Filtros com .loc',
                desc: 'A maneira mais robusta de filtrar dados. Permite condições complexas.',
                code: `<span class="com"># Filtrar: Clientes ativos (status=1) E (&) Idade > 18</span>
filtro = df.<span class="func">loc</span>[ 
    (df[<span class="str">'status'</span>] == 1) & 
    (df[<span class="str">'idade'</span>] > 18) 
]

<span class="com"># Filtrar: Categoria A OU (|) Categoria B</span>
filtro_cat = df.<span class="func">loc</span>[ 
    (df[<span class="str">'categoria'</span>] == <span class="str">'A'</span>) | 
    (df[<span class="str">'categoria'</span>] == <span class="str">'B'</span>) 
]`
            }
        };

        // --- FUNÇÕES DO SISTEMA (MODAL, SIDEBAR, ETC) ---
        function openCheat(id) {
            const data = cheatData[id];
            if(!data) {
                console.error("ID não encontrado:", id); // Debug
                return;
            }

            document.getElementById('mTitle').innerHTML = data.title;
            document.getElementById('mDesc').innerHTML = data.desc;
            document.getElementById('mCode').innerHTML = data.code;
            
            document.getElementById('cheatModal').classList.add('active');
        }

        function closeCheatModal(e, force = false) {
            if (force || e.target.id === 'cheatModal') {
                document.getElementById('cheatModal').classList.remove('active');
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            if (sidebar.classList.contains('open')) {
                sidebar.classList.remove('open'); overlay.classList.remove('show');
            } else {
                sidebar.classList.add('open'); overlay.classList.add('show');
            }
        }

        function copyCode(btn) {
            const pre = btn.nextElementSibling || btn.parentElement.querySelector('pre');
            const code = pre.innerText;
            navigator.clipboard.writeText(code).then(() => {
                const toast = document.getElementById("toast");
                toast.className = "show";
                setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
            });
        }

        function filterSnippets(category) {
            const cards = document.getElementsByClassName('card');
            const btns = document.getElementsByClassName('filter-btn');
            for (let btn of btns) {
                btn.classList.remove('active');
                if (btn.innerText.toLowerCase().includes(category === 'py' ? 'py' : category) || 
                   (category === 'all' && btn.innerText === 'Todos')) { btn.classList.add('active'); }
            }
            for (let i = 0; i < cards.length; i++) {
                let cardCat = cards[i].getAttribute('data-category');
                if (category === 'all' || cardCat === category || (category === 'web' && cardCat === 'web')) {
                    cards[i].style.display = "";
                } else { cards[i].style.display = "none"; }
            }
        }

        function searchSnippets() {
            const input = document.getElementById('searchInput');
            const filter = input.value.toUpperCase();
            const cards = document.getElementsByClassName('card');
            for (let i = 0; i < cards.length; i++) {
                let title = cards[i].getElementsByClassName('card-title')[0];
                let meta = cards[i].getElementsByClassName('card-meta')[0];
                if (title.innerText.toUpperCase().indexOf(filter) > -1 || meta.innerText.toUpperCase().indexOf(filter) > -1) {
                    cards[i].style.display = "";
                } else { cards[i].style.display = "none"; }
            }
        }
    </script>
</body>
</html>